# DDD åˆ†å±‚æ¶æ„è®¾è®¡ (åŸºäº COLA æ¶æ„)

> **å‚è€ƒæ¶æ„ï¼š**
>
> - é˜¿é‡Œå·´å·´ COLA (Clean Object-Oriented and Layered Architecture) v5
> - é˜¿é‡ŒæŠ€æœ¯ä¸“å®¶ DDD ç³»åˆ—
> - Dify å·¥ä½œæµå¼•æ“æ¶æ„
> - å…­è¾¹å½¢æ¶æ„ (Hexagonal Architecture)
>
> **è®¾è®¡æ—¥æœŸï¼š** 2025-12-08
> **ç‰ˆæœ¬ï¼š** v6.0 (è‡ªé¡¶å‘ä¸‹è®¾è®¡)

---

## ç›®å½•

1. [æ•´ä½“æ¶æ„æ¦‚è§ˆ](#1-æ•´ä½“æ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒè®¾è®¡åŸåˆ™](#2-æ ¸å¿ƒè®¾è®¡åŸåˆ™)
3. [åˆ†å±‚æ¶æ„è¯¦è§£](#3-åˆ†å±‚æ¶æ„è¯¦è§£)
4. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#4-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
5. [å®ç°è·¯çº¿å›¾](#5-å®ç°è·¯çº¿å›¾)

---

## 1. æ•´ä½“æ¶æ„æ¦‚è§ˆ

### 1.1 æ¶æ„å…¨æ™¯å›¾

```

succeedâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Adapter Layer (é€‚é…å™¨å±‚)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Web API     â”‚  CLI Tool    â”‚  Java SDK    â”‚  Event Listenerâ”‚ â”‚
â”‚  â”‚  (Spring MVC)â”‚  (Picocli)   â”‚              â”‚  (Message Queue)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Client Layer (å®¢æˆ·ç«¯å±‚)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  API å¥‘çº¦å®šä¹‰ â”‚ DTO â”‚ Request/Response â”‚ é”™è¯¯ç            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Application Layer (åº”ç”¨å±‚)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç”¨ä¾‹ç¼–æ’ â”‚ äº‹åŠ¡ç®¡ç† â”‚ æƒé™æ§åˆ¶ â”‚ DTO è½¬æ¢                â”‚   â”‚
â”‚  â”‚  - PipelineApplicationService                            â”‚   â”‚
â”‚  â”‚  - ExecutionApplicationService                           â”‚   â”‚
â”‚  â”‚  - TaskApplicationService                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â­ Domain Layer (é¢†åŸŸå±‚ - æ ¸å¿ƒ) â­                    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ â”‚ èšåˆæ ¹ â”‚ å€¼å¯¹è±¡ â”‚ é¢†åŸŸæœåŠ¡ â”‚ é¢†åŸŸäº‹ä»¶    â”‚    â”‚
â”‚  â”‚  - ä»»åŠ¡å®šä¹‰ä¸æ‰§è¡Œ                                       â”‚    â”‚
â”‚  â”‚  - æµæ°´çº¿å®šä¹‰ä¸æ‰§è¡Œ                                       â”‚    â”‚
â”‚  â”‚  - å˜é‡ç®¡ç†ä¸è§£æ                                         â”‚    â”‚
â”‚  â”‚  - äº‹ä»¶é©±åŠ¨ç¼–æ’                                          â”‚    â”‚
â”‚  â”‚  - ä¾èµ–è§£æä¸è§¦å‘                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Gateway å®ç° â”‚ æ•°æ®åº“ â”‚ æ¶ˆæ¯é˜Ÿåˆ— â”‚ å¤–éƒ¨ç³»ç»Ÿé›†æˆ         â”‚   â”‚
â”‚  â”‚  - MySQL / PostgreSQL                                    â”‚   â”‚
â”‚  â”‚  - Kafka / RabbitMQ                                      â”‚   â”‚
â”‚  â”‚  - Spark / Flink / K8s / Airflow                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å››å±‚èŒè´£æ€»è§ˆ

| å±‚çº§                     | æ ¸å¿ƒèŒè´£                      | å…³é”®ç‰¹å¾                  |
| ------------------------ | ----------------------------- | ------------------------- |
| **Adapter**        | é€‚é…å¤šç§è®¿é—®æ–¹å¼(Web/CLI/SDK) | è–„å±‚,åªåšåè®®è½¬æ¢         |
| **Client**         | å®šä¹‰å¯¹å¤– API å¥‘çº¦å’Œ DTO       | å¯ç‹¬ç«‹å‘å¸ƒ,æ— å®ç°é€»è¾‘     |
| **Application**    | ç”¨ä¾‹ç¼–æ’ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶  | è–„å±‚,è°ƒç”¨é¢†åŸŸæœåŠ¡         |
| **Domain** â­      | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€ä¸šåŠ¡è§„åˆ™        | çº¯å‡€çš„é¢†åŸŸæ¨¡å‹,ä¸ä¾èµ–æ¡†æ¶ |
| **Infrastructure** | æŠ€æœ¯å®ç°ã€å¤–éƒ¨ç³»ç»Ÿé›†æˆ        | å¯æ›¿æ¢,å®ç° Gateway æ¥å£  |

### 1.3 ä¾èµ–è§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Adapter   â”‚ â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   Client    â”‚ â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ Application â”‚ â”€â”€â”€â”€â”€â”¤  æ‰€æœ‰å±‚éƒ½ä¾èµ– Domain
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â­ Domain â­        â”‚  â† ä¾èµ–å€’ç½®åŸåˆ™ï¼šDomain å®šä¹‰æ¥å£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Infrastructureâ”‚  â† å®ç° Domain å®šä¹‰çš„æ¥å£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŸåˆ™ï¼š**

- Domain å±‚ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨å±‚
- æ‰€æœ‰å±‚éƒ½å¯ä»¥ä¾èµ– Domain å±‚
- Infrastructure å±‚å®ç° Domain å±‚å®šä¹‰çš„ Gateway æ¥å£
- ä¾èµ–æ–¹å‘ï¼šå¤–å±‚ â†’ å†…å±‚

---

## 2. æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 2.1 å…«å¤§è®¾è®¡åŸåˆ™ï¼ˆå‚è€ƒ Dify æ¶æ„ï¼‰

| # | åŸåˆ™                                       | è¯´æ˜                                                                | å‚è€ƒæ¥æº               |
| - | ------------------------------------------ | ------------------------------------------------------------------- | ---------------------- |
| 1 | **Variable å’Œ Event æ˜¯é¢†åŸŸæ¦‚å¿µ**     | ä¸è¦ä½œä¸ºåŸºç¡€è®¾æ–½ç»„ä»¶ï¼Œè€Œæ˜¯ä½œä¸ºå€¼å¯¹è±¡åœ¨é¢†åŸŸå±‚å®šä¹‰                    | Dify VariablePool      |
| 2 | **VariablePool ä½œä¸ºé¢†åŸŸæœåŠ¡**        | ç®¡ç†å˜é‡ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›ç»Ÿä¸€è®¿é—®æ¥å£ï¼ˆé€‰æ‹©å™¨æ¨¡å¼ï¼‰                    | Dify GraphRuntimeState |
| 3 | **èšåˆæ ¹æŒæœ‰å…±äº«çŠ¶æ€**               | PipelineExecution æŒæœ‰ VariablePool å’Œ EventHistory                 | Dify GraphRuntimeState |
| 4 | **äº‹ä»¶é©±åŠ¨æ‰§è¡Œæµ**                   | èŠ‚ç‚¹æ‰§è¡Œ â†’ å‘äº‹ä»¶ â†’ EventHandler å¤„ç† â†’ æ›´æ–°çŠ¶æ€ â†’ è§¦å‘ä¸‹ä¸€èŠ‚ç‚¹ | Dify EventHandler      |
| 5 | **åªè¯»è§†å›¾ä¿æŠ¤æ•°æ®**                 | å¯¹å¤–æš´éœ² ReadOnlyVariablePoolï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹                         | Dify ReadOnlyWrapper   |
| 6 | **Gateway åˆ†ç¦»å…³æ³¨ç‚¹**               | é¢†åŸŸå±‚å®šä¹‰æ¥å£ï¼ŒåŸºç¡€è®¾æ–½å±‚å®ç°ï¼Œå¯éšæ—¶æ›¿æ¢                          | COLA Gateway           |
| 7 | **ExecutionOrchestrator æ˜¯é¢†åŸŸæœåŠ¡** | åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆè§¦å‘è¯„ä¼°ã€ä¾èµ–è§£æï¼‰ï¼Œä¸æ˜¯åº”ç”¨æœåŠ¡                | Dify GraphEngine       |
| 8 | **Application å±‚ä¿æŒè–„å±‚**           | åªåšç”¨ä¾‹ç¼–æ’ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ã€DTO è½¬æ¢                          | COLA Application       |

### 2.2 å…³é”®æ¶æ„å†³ç­–

| å†³ç­–ç‚¹             | é€‰æ‹©                  | ç†ç”±                                 |
| ------------------ | --------------------- | ------------------------------------ |
| **åˆ†å±‚æ¨¡å‹** | COLA å››å±‚ + Gateway   | æ¸…æ™°çš„èŒè´£åˆ†ç¦»,é˜²è…å±‚ä¿æŠ¤é¢†åŸŸ        |
| **æ‰§è¡Œæ¨¡å‹** | äº‹ä»¶é©±åŠ¨              | æ¾è€¦åˆ,æ”¯æŒå¼‚æ­¥æ‰§è¡Œå’Œæµå¼è¾“å‡º        |
| **å˜é‡ç®¡ç†** | VariablePool é¢†åŸŸæœåŠ¡ | ç»Ÿä¸€ç®¡ç†,æ”¯æŒåµŒå¥—è®¿é—®å’Œç±»å‹å®‰å…¨      |
| **çŠ¶æ€ç®¡ç†** | èšåˆæ ¹æŒæœ‰çŠ¶æ€        | PipelineExecution æ˜¯å®Œæ•´çš„æ‰§è¡Œä¸Šä¸‹æ–‡ |
| **æ‰©å±•æ€§**   | Gateway æ¥å£æŠ½è±¡      | å¯æ›¿æ¢å­˜å‚¨/æ¶ˆæ¯é˜Ÿåˆ—/æ‰§è¡Œå¼•æ“         |

---

## 3. åˆ†å±‚æ¶æ„è¯¦è§£

### 3.1 Adapter Layer (é€‚é…å™¨å±‚)

**èŒè´£ï¼š** é€‚é…ä¸åŒçš„è®¿é—®æ–¹å¼ï¼Œå°†å¤–éƒ¨è¯·æ±‚è½¬æ¢ä¸ºåº”ç”¨æœåŠ¡è°ƒç”¨

```
ğŸ“¦ Adapter Layer
â”‚
â”œâ”€â”€ ğŸŒ Web Adapter (REST API)
â”‚   â”œâ”€â”€ Spring MVC Controller
â”‚   â”œâ”€â”€ è¯·æ±‚éªŒè¯ (@Valid)
â”‚   â”œâ”€â”€ å“åº”åºåˆ—åŒ– (Jackson)
â”‚   â””â”€â”€ å¼‚å¸¸å¤„ç† (@ControllerAdvice)
â”‚
â”œâ”€â”€ ğŸ–¥ï¸ CLI Adapter
â”‚   â”œâ”€â”€ Picocli å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ äº¤äº’å¼è¾“å…¥
â”‚   â””â”€â”€ è¾“å‡ºæ ¼å¼åŒ–
â”‚
â”œâ”€â”€ â˜• Java SDK
â”‚   â”œâ”€â”€ å®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ ç±»å‹å®‰å…¨
â”‚   â””â”€â”€ åŒæ­¥/å¼‚æ­¥æ¥å£
â”‚
â””â”€â”€ ğŸ“¨ Event Listener Adapter
    â”œâ”€â”€ Kafka Consumer
    â”œâ”€â”€ RabbitMQ Consumer
    â””â”€â”€ äº‹ä»¶æ¶ˆè´¹å¤„ç†
```

**ç‰¹ç‚¹ï¼š**

- è–„è–„ä¸€å±‚ï¼Œåªåšé€‚é…å’Œæ ¼å¼è½¬æ¢
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- è°ƒç”¨ Application Service

---

### 3.2 Client Layer (å®¢æˆ·ç«¯å±‚)

**èŒè´£ï¼š** å®šä¹‰å¯¹å¤– API å¥‘çº¦ï¼Œå¯ä»¥ç‹¬ç«‹å‘å¸ƒç»™è°ƒç”¨æ–¹

```
ğŸ“¦ Client Layer
â”‚
â”œâ”€â”€ ğŸ“„ DTO å®šä¹‰
â”‚   â”œâ”€â”€ PipelineCreateRequest
â”‚   â”œâ”€â”€ PipelineExecutionResponse
â”‚   â”œâ”€â”€ TaskDefinitionDTO
â”‚   â””â”€â”€ VariableDTO
â”‚
â”œâ”€â”€ ğŸ”Œ API æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ IPipelineService
â”‚   â”œâ”€â”€ IExecutionService
â”‚   â””â”€â”€ ITaskService
â”‚
â””â”€â”€ âš ï¸ é”™è¯¯ç å®šä¹‰
    â”œâ”€â”€ ErrorCode æšä¸¾
    â””â”€â”€ ErrorMessage æ˜ å°„
```

**ç‰¹ç‚¹ï¼š**

- å¯ä»¥è¢«å…¶ä»–æœåŠ¡ä¾èµ–
- åªåŒ…å«æ¥å£å’Œ DTOï¼Œæ— å®ç°
- ç‰ˆæœ¬åŒ–ç®¡ç†

---

### 3.3 Application Layer (åº”ç”¨å±‚)

**èŒè´£ï¼š** ç”¨ä¾‹ç¼–æ’ã€äº‹åŠ¡æ§åˆ¶ã€æƒé™æ§åˆ¶ã€DTO è½¬æ¢

```
ğŸ“¦ Application Layer
â”‚
â”œâ”€â”€ ğŸ¯ Application Services (è–„å±‚ç¼–æ’)
â”‚   â”‚
â”‚   â”œâ”€â”€ PipelineApplicationService
â”‚   â”‚   â”œâ”€â”€ createPipeline(request: PipelineCreateRequest)
â”‚   â”‚   â”œâ”€â”€ startExecution(pipelineId)
â”‚   â”‚   â””â”€â”€ pauseExecution(executionId)
â”‚   â”‚
â”‚   â”œâ”€â”€ ExecutionApplicationService
â”‚   â”‚   â”œâ”€â”€ queryExecution(executionId)
â”‚   â”‚   â”œâ”€â”€ getVariables(executionId, selector)
â”‚   â”‚   â””â”€â”€ subscribeEvents(executionId, pattern)
â”‚   â”‚
â”‚   â””â”€â”€ TaskApplicationService
â”‚       â”œâ”€â”€ createTask(request)
â”‚       â””â”€â”€ executeTask(taskId)
â”‚
â”œâ”€â”€ ğŸ”„ DTO Assembler (DTO ç»„è£…å™¨)
â”‚   â”œâ”€â”€ PipelineAssembler
â”‚   â””â”€â”€ ExecutionAssembler
â”‚
â””â”€â”€ ğŸ“® Event Subscribers (åº”ç”¨å±‚äº‹ä»¶è®¢é˜…)
    â”œâ”€â”€ PipelineCompletedSubscriber
    â””â”€â”€ TaskFailedSubscriber
```

**ç‰¹ç‚¹ï¼š**

- è–„è–„ä¸€å±‚ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- åªåšç¼–æ’ï¼Œè°ƒç”¨é¢†åŸŸæœåŠ¡
- ç®¡ç†äº‹åŠ¡è¾¹ç•Œ

---

### 3.4 Domain Layer (é¢†åŸŸå±‚) â­ æ ¸å¿ƒ

**èŒè´£ï¼š** ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒï¼ŒåŒ…å«èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸæœåŠ¡

è¯¦è§ [ç¬¬ 4 ç« ï¼šæ ¸å¿ƒæ¨¡å—è®¾è®¡](#4-æ ¸å¿ƒæ¨¡å—è®¾è®¡)

---

### 3.5 Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)

**èŒè´£ï¼š** å®ç° Gateway æ¥å£ï¼Œéš”ç¦»æŠ€æœ¯ç»†èŠ‚

```
ğŸ“¦ Infrastructure Layer
â”‚
â”œâ”€â”€ ğŸ”Œ Gateway Implementations
â”‚   â”œâ”€â”€ PostgreSQLVariableStorageGateway
â”‚   â”œâ”€â”€ KafkaEventPublishGateway
â”‚   â”œâ”€â”€ PostgreSQLPipelineRepository
â”‚   â””â”€â”€ SparkExecutorGateway
â”‚
â”œâ”€â”€ ğŸ—„ï¸ Data Objects (DO)
â”‚   â”œâ”€â”€ PipelineExecutionDO
â”‚   â””â”€â”€ TaskExecutionDO
â”‚
â”œâ”€â”€ ğŸ”„ Converters (DO â†” Domain Entity)
â”‚   â””â”€â”€ PipelineExecutionConverter
â”‚
â”œâ”€â”€ ğŸ“‚ Framework Integration (æ¡†æ¶é›†æˆ)
â”‚   â”œâ”€â”€ Spring Boot
â”‚   â”œâ”€â”€ Dependency Injection (Spring IoC)
â”‚   â””â”€â”€ Logging, Monitoring, Tracing
â”‚
â””â”€â”€ ğŸ§© External Systems
    â”œâ”€â”€ Redis
    â”œâ”€â”€ MySQL / PostgreSQL
    â”œâ”€â”€ Kafka / RabbitMQ
    â””â”€â”€ Spark / Flink / K8s
```

**ç‰¹ç‚¹ï¼š**

- å¯éšæ—¶æ›¿æ¢å®ç°
- ä¸å½±å“é¢†åŸŸå±‚
- å®ç°é¢†åŸŸå±‚å®šä¹‰çš„ Gateway æ¥å£

---

## 4. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 æµæ°´çº¿æ‰§è¡Œæ¨¡å— (Pipeline Execution)

#### 4.1.1 æ¨¡å—èŒè´£

ç®¡ç†æµæ°´çº¿çš„æ•´ä¸ªæ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬èŠ‚ç‚¹è°ƒåº¦ã€çŠ¶æ€ç®¡ç†ã€å˜é‡ä¼ é€’ã€äº‹ä»¶å‘å¸ƒã€‚

#### 4.1.2 æ ¸å¿ƒç»„ä»¶

```
ğŸ“¦ Pipeline Execution Module
â”‚
â”œâ”€â”€ ğŸ¯ èšåˆæ ¹
â”‚   â”‚
â”‚   â””â”€â”€ PipelineExecution â­ æ ¸å¿ƒèšåˆæ ¹
â”‚       â”‚
â”‚       â”œâ”€â”€ ã€æ ¸å¿ƒçŠ¶æ€ã€‘
â”‚       â”‚   â”œâ”€â”€ executionId: ExecutionId
â”‚       â”‚   â”œâ”€â”€ pipelineId: PipelineId
â”‚       â”‚   â”œâ”€â”€ status: ExecutionStatus
â”‚       â”‚   â”œâ”€â”€ variablePool: VariablePool (é¢†åŸŸæœåŠ¡)
â”‚       â”‚   â”œâ”€â”€ eventHistory: List<Event>
â”‚       â”‚   â””â”€â”€ nodeExecutions: Map<NodeId, NodeExecution>
â”‚       â”‚
â”‚       â”œâ”€â”€ ã€å®ä½“ã€‘
â”‚       â”‚   â””â”€â”€ NodeExecution (èŠ‚ç‚¹æ‰§è¡Œ)
â”‚       â”‚       â”œâ”€â”€ nodeId, status
â”‚       â”‚       â”œâ”€â”€ inputs, outputs
â”‚       â”‚       â””â”€â”€ ç‰¹ç‚¹ï¼šèŠ‚ç‚¹çº§åˆ«çš„æ‰§è¡ŒçŠ¶æ€
â”‚       â”‚
â”‚       â””â”€â”€ ã€ä¸šåŠ¡æ–¹æ³•ã€‘
â”‚           â”œâ”€â”€ executeNode(nodeId)
â”‚           â”œâ”€â”€ publishEvent(event)
â”‚           â”œâ”€â”€ subscribeToEvent(pattern, handler)
â”‚           â”œâ”€â”€ getVariable(selector)
â”‚           â”œâ”€â”€ setVariable(selector, value)
â”‚           â”œâ”€â”€ pauseExecution()
â”‚           â””â”€â”€ resumeExecution()
â”‚
â”œâ”€â”€ ğŸ› ï¸ é¢†åŸŸæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ ExecutionOrchestrator â­ æ‰§è¡Œç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ èŒè´£ï¼šåè°ƒèŠ‚ç‚¹æ‰§è¡Œæµç¨‹
â”‚   â”‚   â”œâ”€â”€ executeNode() - æ‰§è¡Œå•ä¸ªèŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ getReadyNodes() - è·å–å°±ç»ªèŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ handleNodeCompletion() - å¤„ç†èŠ‚ç‚¹å®Œæˆ
â”‚   â”‚
â”‚   â””â”€â”€ DependencyResolutionService (ä¾èµ–è§£æ)
â”‚       â”œâ”€â”€ è§£æ startWhen/stopWhen
â”‚       â””â”€â”€ æŸ¥è¯¢å“ªäº›èŠ‚ç‚¹è¢«äº‹ä»¶è§¦å‘
â”‚
â”œâ”€â”€ ğŸ“® é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ PipelineStartedEvent
â”‚   â”œâ”€â”€ PipelineCompletedEvent
â”‚   â”œâ”€â”€ NodeRunStartedEvent
â”‚   â”œâ”€â”€ NodeRunSucceededEvent â­
â”‚   â””â”€â”€ NodeRunFailedEvent
â”‚
â””â”€â”€ ğŸ”Œ Gateway æ¥å£
    â”œâ”€â”€ PipelineExecutionGateway
    â””â”€â”€ ExecutorGateway (è°ƒç”¨å¤–éƒ¨æ‰§è¡Œå¼•æ“)
```

#### 4.1.3 æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è§¦å‘ â†’ Application Service â†’ PipelineExecution.start()
                                        â†“
                        ExecutionOrchestrator.getReadyNodes()
                                        â†“
                        ExecutionOrchestrator.executeNode()
                                        â†“
                        å‘å¸ƒ NodeRunStartedEvent
                                        â†“
                        èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
                                        â†“
                        å‘å¸ƒ NodeRunSucceededEvent
                                        â†“
                        EventHandler å¤„ç†äº‹ä»¶
                                        â†“
                        æ›´æ–° VariablePool
                                        â†“
                        è§¦å‘ä¾èµ–èŠ‚ç‚¹
```

---

### 4.2 å˜é‡ç®¡ç†æ¨¡å— (Variable Management)

#### 4.2.1 æ¨¡å—èŒè´£

ç®¡ç†æ‰§è¡ŒæœŸé—´çš„æ‰€æœ‰å˜é‡ï¼Œæä¾›ç»Ÿä¸€è®¿é—®æ¥å£ï¼Œæ”¯æŒç±»å‹å®‰å…¨å’ŒåµŒå¥—è®¿é—®ã€‚

#### 4.2.2 æ ¸å¿ƒç»„ä»¶

```
ğŸ“¦ Variable Management Module
â”‚
â”œâ”€â”€ ğŸ’ å€¼å¯¹è±¡
â”‚   â”‚
â”‚   â”œâ”€â”€ Variable (å˜é‡å€¼å¯¹è±¡) â­
â”‚   â”‚   â”œâ”€â”€ id: VariableId
â”‚   â”‚   â”œâ”€â”€ name: String
â”‚   â”‚   â”œâ”€â”€ type: VariableType
â”‚   â”‚   â”œâ”€â”€ value: Object
â”‚   â”‚   â”œâ”€â”€ selector: List[String]
â”‚   â”‚   â””â”€â”€ ç‰¹ç‚¹ï¼šç±»å‹å®‰å…¨ã€ä¸å¯å˜
â”‚   â”‚
â”‚   â”œâ”€â”€ VariableSelector (é€‰æ‹©å™¨)
â”‚   â”‚   â”œâ”€â”€ path: List[String]
â”‚   â”‚   â”œâ”€â”€ ä¾‹å¦‚: ["node1", "output", "result"]
â”‚   â”‚   â””â”€â”€ æ”¯æŒåµŒå¥—å±æ€§è®¿é—®
â”‚   â”‚
â”‚   â”œâ”€â”€ VariableReference (å¼•ç”¨)
â”‚   â”‚   â”œâ”€â”€ expression: String
â”‚   â”‚   â”œâ”€â”€ ä¾‹å¦‚: "{{#node1.output#}}"
â”‚   â”‚   â””â”€â”€ resolve(pool) - è§£æä¸ºå®é™…å€¼
â”‚   â”‚
â”‚   â””â”€â”€ VariableType (ç±»å‹æšä¸¾)
â”‚       â””â”€â”€ STRING, INTEGER, FLOAT, OBJECT, ARRAY, FILE
â”‚
â”œâ”€â”€ ğŸ› ï¸ é¢†åŸŸæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ VariablePool â­ å˜é‡æ± 
â”‚   â”‚   â”œâ”€â”€ èŒè´£ï¼šç®¡ç†æ‰€æœ‰å˜é‡
â”‚   â”‚   â”œâ”€â”€ æ•°æ®ç»“æ„ï¼šMap<nodeId, Map<varName, Variable>>
â”‚   â”‚   â”œâ”€â”€ get(selector: List[str]) - è·å–å˜é‡
â”‚   â”‚   â”œâ”€â”€ add(selector, value) - æ·»åŠ /æ›´æ–°
â”‚   â”‚   â”œâ”€â”€ remove(selector) - ç§»é™¤
â”‚   â”‚   â””â”€â”€ getByPrefix(nodeIdPrefix) - æŒ‰èŠ‚ç‚¹è·å–
â”‚   â”‚
â”‚   â””â”€â”€ VariableResolutionService (è§£ææœåŠ¡)
â”‚       â”œâ”€â”€ è§£æå˜é‡å¼•ç”¨ (ç‚¹å·è·¯å¾„)
â”‚       â”œâ”€â”€ è§£æè¡¨è¾¾å¼ (æ¨¡æ¿)
â”‚       â””â”€â”€ ç±»å‹è½¬æ¢å’ŒéªŒè¯
â”‚
â””â”€â”€ ğŸ”Œ Gateway æ¥å£
    â””â”€â”€ VariableStorageGateway
        â”œâ”€â”€ saveVariables(executionId, pool)
        â””â”€â”€ loadVariables(executionId) -> VariablePool
        æ³¨ï¼šä½¿ç”¨ PostgreSQL å®ç°ï¼Œä¸ä½¿ç”¨ Redis
```

#### 4.2.3 å˜é‡è®¿é—®ç¤ºä¾‹

```java
// 1. é€šè¿‡é€‰æ‹©å™¨è·å–
Variable variable = variablePool.get(Arrays.asList("node1", "output", "result"));

// 2. æ”¯æŒåµŒå¥—è®¿é—®
Variable nested = variablePool.get(Arrays.asList("node2", "data", "user", "name"));

// 3. é€šè¿‡è¡¨è¾¾å¼å¼•ç”¨
VariableReference reference = new VariableReference("{{#node1.output#}}");
Object value = reference.resolve(variablePool);

// 4. åªè¯»è§†å›¾
ReadOnlyVariablePool readOnlyPool = variablePool.asReadOnly();
```

---

### 4.3 äº‹ä»¶é©±åŠ¨æ¨¡å— (Event-Driven Orchestration)

#### 4.3.1 æ¨¡å—èŒè´£

å®ç°äº‹ä»¶é©±åŠ¨çš„æ‰§è¡Œæµç¨‹ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†ã€äº‹ä»¶è®¢é˜…ã€æ¡ä»¶è§¦å‘ã€‚

#### 4.3.2 æ ¸å¿ƒç»„ä»¶

```
ğŸ“¦ Event-Driven Module
â”‚
â”œâ”€â”€ ğŸ’ å€¼å¯¹è±¡
â”‚   â”‚
â”‚   â”œâ”€â”€ Event (äº‹ä»¶å€¼å¯¹è±¡) â­
â”‚   â”‚   â”œâ”€â”€ eventId: EventId
â”‚   â”‚   â”œâ”€â”€ eventType: String
â”‚   â”‚   â”œâ”€â”€ source: NodeId
â”‚   â”‚   â”œâ”€â”€ timestamp: DateTime
â”‚   â”‚   â”œâ”€â”€ payload: Map<String, Object>
â”‚   â”‚   â””â”€â”€ ç‰¹ç‚¹ï¼šä¸å¯å˜ã€å®Œæ•´è®°å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ EventPattern (äº‹ä»¶æ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ pattern: String
â”‚   â”‚   â”œâ”€â”€ ä¾‹å¦‚: "node.*.completed"
â”‚   â”‚   â”œâ”€â”€ matches(event) - åˆ¤æ–­æ˜¯å¦åŒ¹é…
â”‚   â”‚   â””â”€â”€ ç”¨äº startWhen/stopWhen
â”‚   â”‚
â”‚   â””â”€â”€ TriggerCondition (è§¦å‘æ¡ä»¶)
â”‚       â”œâ”€â”€ eventPattern: EventPattern
â”‚       â”œâ”€â”€ expression: String (å¯é€‰)
â”‚       â””â”€â”€ evaluate(event, context) - è¯„ä¼°
â”‚
â”œâ”€â”€ ğŸ› ï¸ é¢†åŸŸæœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ EventSubscriptionManager â­ è®¢é˜…ç®¡ç†å™¨
â”‚       â”œâ”€â”€ èŒè´£ï¼šç®¡ç†è®¢é˜…å…³ç³»ï¼ŒåŒ¹é…è§¦å‘
â”‚       â”œâ”€â”€ subscribe(pattern, handler)
â”‚       â”œâ”€â”€ unsubscribe(pattern, handler)
â”‚       â”œâ”€â”€ getMatchingHandlers(event)
â”‚       â””â”€â”€ evaluateTrigger(event, condition)
â”‚
â”œâ”€â”€ ğŸ“® é¢†åŸŸäº‹ä»¶å±‚æ¬¡
â”‚   â”‚
â”‚   â”œâ”€â”€ GraphEngineEvent (åŸºç±»)
â”‚   â”œâ”€â”€ GraphEvent (å›¾çº§åˆ«)
â”‚   â””â”€â”€ NodeEvent (èŠ‚ç‚¹çº§åˆ«)
â”‚
â””â”€â”€ ğŸ”Œ Gateway æ¥å£
    â”‚
    â”œâ”€â”€ EventPublishGateway
    â”‚   â”œâ”€â”€ publish(event)
    â”‚   â””â”€â”€ subscribe(eventType, consumer)
    â”‚
    â””â”€â”€ EventStoreGateway
        â”œâ”€â”€ append(executionId, event)
        â””â”€â”€ queryEvents(executionId, eventType)
```

#### 4.3.3 äº‹ä»¶å¤„ç†æµç¨‹

```
èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
    â†“
å‘å¸ƒ NodeRunSucceededEvent
    â†“
EventSubscriptionManager.getMatchingHandlers(event)
    â†“
æ‰¾åˆ°åŒ¹é…çš„è®¢é˜…è€… (startWhen æ¡ä»¶)
    â†“
è¯„ä¼°è§¦å‘æ¡ä»¶ (TriggerCondition.evaluate)
    â†“
æ¡ä»¶æ»¡è¶³ â†’ è§¦å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œ
    â†“
ExecutionOrchestrator.executeNode()
```

---

### 4.4 æµæ°´çº¿å®šä¹‰æ¨¡å— (Pipeline Definition)

#### 4.4.1 æ¨¡å—èŒè´£

ç®¡ç†æµæ°´çº¿çš„ç»“æ„å®šä¹‰ã€èŠ‚ç‚¹é…ç½®ã€ä¾èµ–å…³ç³»ã€éªŒè¯è§„åˆ™ã€‚

#### 4.4.2 æ ¸å¿ƒç»„ä»¶

```
ğŸ“¦ Pipeline Definition Module
â”‚
â”œâ”€â”€ ğŸ¯ èšåˆæ ¹
â”‚   â”‚
â”‚   â””â”€â”€ PipelineDefinition (æµæ°´çº¿å®šä¹‰)
â”‚       â”‚
â”‚       â”œâ”€â”€ ã€æ ¸å¿ƒçŠ¶æ€ã€‘
â”‚       â”‚   â”œâ”€â”€ pipelineId: PipelineId
â”‚       â”‚   â”œâ”€â”€ name: String
â”‚       â”‚   â”œâ”€â”€ version: Version
â”‚       â”‚   â”œâ”€â”€ nodes: List<NodeDefinition>
â”‚       â”‚   â””â”€â”€ status: DefinitionStatus
â”‚       â”‚
â”‚       â”œâ”€â”€ ã€å®ä½“ã€‘
â”‚       â”‚   â””â”€â”€ NodeDefinition (èŠ‚ç‚¹å®šä¹‰)
â”‚       â”‚       â”œâ”€â”€ nodeId, nodeType
â”‚       â”‚       â”œâ”€â”€ config: Map<String, Object>
â”‚       â”‚       â”œâ”€â”€ startWhen: EventPattern
â”‚       â”‚       â””â”€â”€ stopWhen: EventPattern
â”‚       â”‚
â”‚       â””â”€â”€ ã€ä¸šåŠ¡æ–¹æ³•ã€‘
â”‚           â”œâ”€â”€ validateDefinition() - éªŒè¯å®Œæ•´æ€§
â”‚           â”œâ”€â”€ publish() - å‘å¸ƒç‰ˆæœ¬
â”‚           â””â”€â”€ addNode(node) - æ·»åŠ èŠ‚ç‚¹
â”‚
â””â”€â”€ ğŸ”Œ Gateway æ¥å£
    â””â”€â”€ PipelineDefinitionGateway
        â”œâ”€â”€ save(definition)
        â””â”€â”€ findById(pipelineId)
```

---

## 5. å®ç°è·¯çº¿å›¾

### 5.1 Phase 1: é¢†åŸŸå±‚æ ¸å¿ƒ (Week 1-2)

**ç›®æ ‡ï¼š** æ„å»ºçº¯å‡€çš„é¢†åŸŸæ¨¡å‹

- [ ] å®šä¹‰å€¼å¯¹è±¡ (Variable, Event, VariableSelector)
- [ ] å®ç° VariablePool é¢†åŸŸæœåŠ¡
- [ ] å®ç° EventSubscriptionManager é¢†åŸŸæœåŠ¡
- [ ] å®šä¹‰ PipelineExecution èšåˆæ ¹
- [ ] å®šä¹‰ Gateway æ¥å£

**éªŒæ”¶æ ‡å‡†ï¼š** é¢†åŸŸæ¨¡å‹å¯ä»¥ç‹¬ç«‹è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œä¸ä¾èµ–åŸºç¡€è®¾æ–½

---

### 5.2 Phase 2: åŸºç¡€è®¾æ–½å±‚ (Week 3)

**ç›®æ ‡ï¼š** å®ç° Gateway æ¥å£

- [ ] å®ç° PostgreSQLVariableStorageGateway (ä½¿ç”¨ PostgreSQL å­˜å‚¨å˜é‡ï¼Œä¸ä½¿ç”¨ Redis)
- [ ] å®ç° InMemoryEventPublishGateway (å…ˆç”¨å†…å­˜ï¼Œåç»­æ¢ Kafka)
- [ ] å®ç° PostgreSQLPipelineRepository
- [ ] å®ç°äº‹ä»¶å¤„ç†å™¨ (EventHandler)

**éªŒæ”¶æ ‡å‡†ï¼š** å¯ä»¥æŒä¹…åŒ–å’Œæ¢å¤ PipelineExecution çŠ¶æ€

---

### 5.3 Phase 3: åº”ç”¨å±‚ä¸é€‚é…å™¨å±‚ (Week 4)

**ç›®æ ‡ï¼š** å®Œæˆç«¯åˆ°ç«¯æµç¨‹

- [ ] å®ç° Application Service (è–„å±‚ç¼–æ’)
- [ ] å®ç° Spring MVC Web Adapter
- [ ] å®ç° DTO Assembler
- [ ] é›†æˆæµ‹è¯•

**éªŒæ”¶æ ‡å‡†ï¼š** å¯ä»¥é€šè¿‡ REST API åˆ›å»ºå’Œæ‰§è¡Œæµæ°´çº¿

---

### 5.4 Phase 4: é«˜çº§ç‰¹æ€§ (Week 5-6)

**ç›®æ ‡ï¼š** å¢å¼ºåŠŸèƒ½

- [ ] å®ç° ExecutionOrchestrator (å¤æ‚ç¼–æ’é€»è¾‘)
- [ ] æ”¯æŒäº‹ä»¶é©±åŠ¨è§¦å‘ (startWhen/stopWhen)
- [ ] å®ç°åªè¯»è§†å›¾ (ReadOnlyVariablePool)
- [ ] å®ç°æµå¼è¾“å‡º (NodeRunStreamChunkEvent)
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§

**éªŒæ”¶æ ‡å‡†ï¼š** æ”¯æŒå¤æ‚çš„äº‹ä»¶é©±åŠ¨å·¥ä½œæµ

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv5.1 (COLA é£æ ¼ + Dify æ¶æ„å®è·µ)

**æœ€åæ›´æ–°**ï¼š2025-12-08

**å‚è€ƒæ¶æ„**ï¼š

- é˜¿é‡Œå·´å·´ COLA v5
- Dify å·¥ä½œæµå¼•æ“æ¶æ„
- å…­è¾¹å½¢æ¶æ„ (Hexagonal Architecture)
- æ•´æ´æ¶æ„ (Clean Architecture)

**ä½œè€…**ï¼šæ¶æ„è®¾è®¡ç»„
