# 术语表 (Glossary)

本文档汇总了数据流编排平台中的核心术语及其定义。所有术语在文档中以 **《术语 Term》** 格式标识。

## 核心领域模型

### **《TaskDefinition 任务定义》**

**英文**: TaskDefinition

**定义**: 可复用的任务模板，定义了一类任务"能做什么"、"需要什么输入"、"产生什么输出"。独立于流水线存在，可被多个流水线的多个节点引用。

**职责**:
- 定义任务类型及其特有的行为能力
- 声明输入变量和输出变量接口契约
- 定义任务在不同状态下产生的事件
- 支持版本管理和跨流水线复用

**相关术语**: **《Node 节点》**、**《Pipeline 流水线》**、**《Action 行为》**、**《Event 事件》**

---

### **《Node 节点》**

**英文**: Node

**定义**: 流水线中的编排单元，代表工作流中的一个执行点。通过引用任务定义并配置执行控制逻辑，将可复用的任务模板实例化到具体的业务流程中。

**职责**:
- 引用任务定义声明"要做什么"
- 绑定输入变量，指定输入从哪里来
- 通过表达式定义"何时执行"
- 通过事件订阅隐式定义依赖关系

**关键特性**: 节点是任务定义的实例化，定义"何时做、如何做"

**相关术语**: **《TaskDefinition 任务定义》**、**《Pipeline 流水线》**、**《Expression 表达式》**、**《Event 事件》**

---

### **《PipelineDefinition 流水线定义》**

**英文**: PipelineDefinition

**别名**: **《Pipeline 流水线》**

**定义**: 编排聚合根，定义了数据处理流水线的完整结构。通过一系列节点来组织执行流程，每个节点引用一个任务定义并通过事件驱动的方式控制执行顺序和依赖关系。

**职责**:
- 定义节点列表
- 实现事件驱动编排
- 定义流水线级别的输入/输出接口
- 维护版本管理（DRAFT/PUBLISHED）

**关键特性**:
- 事件驱动编排（无显式 ConditionNode、JoinNode、ForkNode）
- 扁平化结构（只有 `nodes[]` 数组）
- 可作为整体被其他流水线引用

**相关术语**: **《Node 节点》**、**《TaskDefinition 任务定义》**、**《Expression 表达式》**、**《Event 事件》**

---

### **《Expression 表达式》**

**英文**: Expression

**定义**: 用于控制节点执行时机和条件的表达式语言，支持事件表达式和状态表达式。

**类型**:
- **事件表达式**: 订阅事件，如 `event:node.completed`、`cron:0 2 * * *`
- **状态表达式**: 检查状态，如 `{{ quality_score > 0.9 }}`
- **混合表达式**: 组合事件和状态，如 `event:upstream.completed && {{ row_count > 0 }}`

**使用场景**:

- `startWhen`: 定义节点何时启动执行（必填）
- `stopWhen`: 定义流处理任务何时停止执行
- `restartWhen`: 定义流处理任务何时重启执行
- `retryWhen`: 定义任务失败后何时重试执行
- `alertWhen`: 定义何时触发告警通知

**相关术语**: **《Node 节点》**、**《Event 事件》**

---

### **《Event 事件》**

**英文**: Event

**定义**: 节点在执行过程中产生的状态通知，用于实现事件驱动的依赖控制。

**常见事件**:
- `started`: 任务已启动
- `completed`: 任务已完成
- `failed`: 任务失败
- `stopped`: 流处理任务已停止
- `approved`: 审批通过
- `rejected`: 审批拒绝
- `timeout`: 超时

**事件引用格式**: `event:<node_id>.<event_name>`

**使用方式**: 下游节点通过 `startWhen` 表达式订阅上游事件

**相关术语**: **《Node 节点》**、**《Expression 表达式》**、**《Action 行为》**

---

### **《Action 行为》**

**英文**: Action

**定义**: 任务定义支持的操作能力，不同任务类型支持不同的行为。

**常见行为**:
- `start`: 启动任务（所有任务类型）
- `stop`: 停止任务（仅流处理任务）
- `restart`: 重启任务（仅流处理任务）
- `retry`: 重试任务（除审批任务外）

**行为与任务类型对应**:
- **批处理任务**（PySpark/SQL/Ray）: `start`、`retry`
- **流处理任务**: `start`、`stop`、`restart`、`retry`
- **审批任务**: 仅 `start`（外部控制）
- **等待任务**: 仅 `start`

**相关术语**: **《TaskDefinition 任务定义》**、**《Event 事件》**

---

### **《VariableDefinition 变量定义》**

**英文**: VariableDefinition

**定义**: 值对象，用于定义变量的元数据（名称、类型、验证规则等）。在任务定义和流水线定义中用于声明输入/输出接口契约。

**职责**:
- 定义变量的名称、类型
- 定义变量是否必填
- 定义默认值和验证规则
- 提供变量的描述信息

**使用位置**:
- **《TaskDefinition 任务定义》**的 `inputVariables` 和 `outputVariables`
- **《PipelineDefinition 流水线定义》**的 `inputVariables` 和 `outputVariables`

**关键特性**: 只定义"这个变量是什么"，不涉及"如何获取"或"如何转换"

**相关术语**: **《VariableReference 变量引用》**

---

### **《VariableReference 变量引用》**

**英文**: VariableReference

**定义**: 值对象，用于在节点中指定如何获取和使用变量。通过表达式将任务定义声明的输入变量绑定到具体的数据源。

**职责**:
- 定义变量的来源（上游节点输出、流水线输入、常量）
- 定义变量的转换逻辑
- 提供降级和默认值机制

**使用位置**:
- **《Node 节点》**的 `inputBindings`

**关键特性**: 变量定义声明"需要什么"，变量引用指定"从哪里来"

**相关术语**: **《VariableDefinition 变量定义》**、**《Node 节点》**、**《Expression 表达式》**

---

### **《TaskType 任务类型》**

**英文**: TaskType

**定义**: 任务的分类，不同类型有不同的行为能力和事件规约。

**常见类型**:
- **PySpark**: 批处理 Spark 任务
- **SQL**: SQL 查询任务
- **Ray**: Ray 分布式计算任务
- **Streaming**: 流处理任务
- **Approval**: 审批任务
- **Wait**: 等待任务

**相关术语**: **《TaskDefinition 任务定义》**、**《Action 行为》**、**《Event 事件》**

---

## 控制流概念

### **事件驱动编排 (Event-Driven Orchestration)**

**定义**: 节点之间通过订阅和发布事件来实现依赖控制，而不使用显式的依赖声明。

**关键机制**:
- 上游节点产生事件（如 `completed`、`failed`）
- 下游节点通过 `startWhen` 表达式订阅上游事件
- 依赖关系隐式定义，无需显式 `dependsOn` 字段

**优势**:
- 解耦节点之间的依赖
- 支持复杂的条件分支和汇聚逻辑
- 避免显式控制节点（ConditionNode、JoinNode、ForkNode）

---

### **条件分支 (Conditional Branch)**

**定义**: 根据上游节点的执行结果或状态，选择性地执行不同的下游节点。

**实现方式**: 通过不同的 `startWhen` 表达式实现

**示例**:
```yaml
# 高质量路径
- startWhen: "event:quality_check.completed && {{ quality_check.score > 0.9 }}"

# 低质量路径
- startWhen: "event:quality_check.completed && {{ quality_check.score <= 0.9 }}"
```

---

### **汇聚 (Join)**

**定义**: 等待多个上游节点都完成后再执行。

**实现方式**: 通过 `startWhen` 订阅多个事件

**示例**:
```yaml
startWhen: "event:branch_a.completed && event:branch_b.completed"
```

---

### **并行 (Fork)**

**定义**: 同时启动多个独立的节点。

**实现方式**: 多个节点订阅同一个上游事件

**示例**:
```yaml
- id: branch_a
  startWhen: "event:prepare.completed"

- id: branch_b
  startWhen: "event:prepare.completed"
```

---

## 版本管理

### **DRAFT 状态**

**定义**: 草稿状态的版本，可以修改。每个流水线或任务最多有一个 DRAFT 版本。

---

### **PUBLISHED 状态**

**定义**: 已发布的版本，不可修改。可以有多个 PUBLISHED 版本，版本号遵循语义化版本规范。

---

## 术语索引

按字母顺序排列：

- **《Action 行为》** - 任务支持的操作能力
- **《Event 事件》** - 节点产生的状态通知
- **《Expression 表达式》** - 控制执行时机的表达式
- **《Node 节点》** - 流水线中的编排单元
- **《Pipeline 流水线》** - 数据处理流水线（同 **《PipelineDefinition 流水线定义》**）
- **《PipelineDefinition 流水线定义》** - 流水线的完整定义
- **《TaskDefinition 任务定义》** - 可复用的任务模板
- **《TaskType 任务类型》** - 任务的分类
- **《VariableDefinition 变量定义》** - 变量的元数据定义
- **《VariableReference 变量引用》** - 变量的绑定和转换

---

## 术语标识规范

在所有领域模型文档中，术语使用 **《术语 Term》** 格式标识：

- 使用书名号《》包裹术语
- 术语采用"中文 英文"格式
- 整体使用加粗 `**《术语 Term》**`
- 便于提取和索引

**示例**:
- **《TaskDefinition 任务定义》**
- **《Node 节点》**
- **《Pipeline 流水线》**
- **《Expression 表达式》**
- **《Event 事件》**
